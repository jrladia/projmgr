<div class="test container">
<h1>Projects by <%= @description %></h1>
<ul class = "sort">
        <h5> Sort Options </h5>
        <li><%= link_to '<button type="button" class="standard-button">Project Number 000 – 999</button>'.html_safe, action: 'index', order: 'pnum_asc', desc:'Project Number – Ascending' %></li>
        <li><%= link_to '<button type="button" class="standard-button">Project Number 999 – 000</button>'.html_safe, action: 'index', order: 'pnum_desc', desc:'Project Number – Descending' %></li>
        <li><%= link_to '<button type="button" class="standard-button">Project Name A–Z</button>'.html_safe, action: 'index', order: 'pname_asc', desc:'Project Name A-Z' %></li>
        <li><%= link_to '<button type="button" class="standard-button">Project Name Z–A</button>'.html_safe, action: 'index', order: 'pname_desc', desc:'Project Name Z–A' %></li>
        <li><%= link_to '<button type="button" class="standard-button">Stage</button>'.html_safe, action: 'index', order: 'stage', desc:'Stage' %></li>
        <li><%= link_to '<button type="button" class="standard-button">Project Manager A–Z</button>'.html_safe, action: 'index', order: 'pm', desc:'Project Manager' %></li>
        <li><%= link_to '<button type="button" class="standard-button">Job Captain A–Z</button>'.html_safe, action: 'index', order: 'jc', desc:'Job Captain' %></li>
        <li><%= link_to '<button type="button" class="standard-button">Number of Team Members</button>'.html_safe, action: 'index', order: 'num_team', desc:'Number of Team Members' %></li>
    </ul>
        
<% @projectssorted.each do |p|%>
    <li class = "project">
        <section class = "projectinfo">
            <p id = "projnumber"> <%= p.projnumber %> </p>
            <p id = "projname"> <%= p.projname %> </p>
            <p id = "scope"> <%= p.scope %> </p>
            <p id = "status"> <span class="status_num"><%= p.status %></span>% <%= p.stage %></p>
            <ul class = "buttons">
                 <li><%= link_to '<button type="button" class="show editbutton">Show Details</button>'.html_safe, "/projects/#{p.projnumber}/"%> </li>
                 <li> <%= link_to '<button type="button" class="edit editbutton">Edit</button>'.html_safe, "/projects/#{p.projnumber}/edit/"%></li>
                 <li><%= link_to '<button type="button" class="delete editbutton">Delete Project</button>'.html_safe, project_path(p.projnumber), method: "delete"%></li>
            </ul>
        </section>
        
        <section class = "progressbar">
            <% marker = p.stage %>
            <% counter = 0 %>
            <% keys = @stages.keys %>
            <% while keys[counter] != marker do %>
                <% counter+=1 %>
            <% end %>
            
            <% unless p.allstages.nil? || p.allstages.gsub(/\s+/, "") == "" %>
                <% p.allstages.to_s.gsub(/\p{Ps}/, "").gsub(/\p{Pe}/, "").split(", ").each do |x| %>
                    
                    <%if counter>=0%>
                        <div class = "progressbar_space" style = "background: <%= @stages[x.gsub(/["]/,"")] %>"></div>
                    <%else%>
                        <div class = "progressbar_space unfilled" style = "border-right: 1px solid #black;"></div>
                    <%end%>
                    
                    <% counter-=1%>
                <% end %>
            <% end %> 
            <div class = "progress_white"></div>
        </section>

        <ul class = "teaminfo">
            <li class = "team pm"> 
                <% unless p.pm == "" %> 
                    <%= image_tag Teammember.find(p.pm).img, :class => 'headshot small'%> <article><%= Teammember.find(p.pm).first_name %>
                <% else %>
                    <img class="headshot small"><article>?
                <% end %>
                <h5>PM</h5></article>
            </li>
            
            
            <li class = "team jc"> 
                <% unless p.jc == "" %>
                    <%= image_tag Teammember.find(p.jc).img, :class => 'headshot small'%> <article><%= Teammember.find(p.jc).first_name %>
                <% else %>
                     <img class="headshot small"><article>N/A
                <% end %>
                <h5>JC</h5></article>
            </li>
            
            <ul class = "team production">
                <li>
                    <% unless p.prod.nil? || p.prod.gsub(/\s+/, "") == "" %>
                        <% p.prod.gsub(/\W/, " ").split(" ").each  do |x| %>
                            <%= image_tag Teammember.find_by_first_name(x).img, :class => 'headshot small'%>
                            <article><%= x %></article>
                        <% end %>
                    <% else %>
                         <img class="headshot small"><article>N/A
                    <% end %>
                </li>
            </ul> 
        </ul>
        
       
    </li>
<% end %>
</div>
